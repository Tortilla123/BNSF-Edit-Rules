<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>RER EDIT RULES</title>

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
        integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

    <!--  Bootstrap Table CSS for the table -->
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.16.0/dist/bootstrap-table.min.css">

    <!-- FontAwesome Icons-->
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">

    <!--Removes Favicon Error-->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

    <!-- Custom styles for this template -->
    <link href="/src/css/sidebar.css" rel="stylesheet" type="text/css">
    <link href="/src/css/modal.css" rel="stylesheet" type="text/css">

</head>

<body>

    <div id="wrapper">

        <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <h3>
                        Search Criteria
                    </h3>
                </li>

                <!--Drop down menu to select which data table to display-->
                <li>
                    <div class="dropdown">

                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select Rule
                        </button>


                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <option class="dropdown-item" id="cdi-override">CDI OVERRIDE EDITS</option>
                            <option class="dropdown-item" id="enforce-fleet">ENFORCE FLEET LIMIT EDITS</option>
                        </div>

                    </div>
                </li>

                <!--Search the table-->
                <li>
                    <input class="form-control" id="filter" type="text" placeholder="Search...">
                </li>

            </ul>
        </div>
        <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper">

            <!--Top of page header-->
            <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom"
                style="display:flex; justify-content: space-between;">
                <button class="btn btn-info" id="menu-toggle"><i class="icon-angle-left"></i> </button>
                <img src="BNSFLogo.png" width="200" height="50" />
            </nav>

            <div class="container-fluid" style="overflow-x:auto;">

                <!--Table to display data-->
                <table class="table table-striped" id="table">
                    <!--Table Name-->
                    <div id="addTableTitleHere"></div>

                    <thead>
                        <tr>
                            <th data-field="RuleLevel"> Rule Level </th>
                            <th data-field="CustomerName"> Customer Name </th>
                            <th data-field="CityName"> City Name </th>
                            <th data-field="State"> State </th>
                            <th data-field="Fleet"> Fleet </th>
                            <th data-field="Type"> Type </th>
                            <th data-field="Overage"> Overage </th>
                            <th data-field="Maximum"> Maximum </th>
                            <th data-field="LstMaintId"> Lst Maint Id </th>
                            <th data-field="LstMaintTS"> Lst Maint TS </th>
                            <th data-field="Comments"> Comments</th>
                            <th data-field="Actions"> Actions </th>
                        </tr>
                    </thead>

                    <tbody id="tableBody">
                        <tr></tr>
                    </tbody>
                </table>

            </div>
        </div>
        <!-- /#page-content-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- Add Modal HTML -->
    <div id="addModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="addRow">
                    <div class="modal-header">
                        <h4 class="modal-title">Add Row</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">

                        <div class="form-group">
                            <label>Rule Level</label>
                            <input id="RuleLevel1" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Customer Name</label>
                            <input id="CustomerName1" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>City Name</label>
                            <input id="CityName1" class="form-control"></input>
                        </div>
                        <div class="form-group">
                            <label>State</label>
                            <input id="State1" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Fleet</label>
                            <input id="Fleet1" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Type</label>
                            <input id="Type1" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Overage</label>
                            <input id="Overage1" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Maximum</label>
                            <input id="Maximum1" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Comments</label>
                            <input id="Comment1" type="text" class="form-control">
                        </div>

                    </div>

                    <div class="modal-footer">
                        <input type="button" class="btn btn-danger" data-dismiss="modal" value="Cancel">
                        <input type="submit" class="btn btn-success" data-dismiss="modal" value="Add">
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Modal HTML -->
    <div id="editModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="editRow">
                    <div class="modal-header">
                        <h4 class="modal-title">Edit Row</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">

                        <div class="form-group">
                            <label>Rule Level</label>
                            <input id="editRuleLevel" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Customer Name</label>
                            <input id="editCustomerName" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>City Name</label>
                            <input id="editCityName" class="form-control"></input>
                        </div>
                        <div class="form-group">
                            <label>State</label>
                            <input id="editState" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Fleet</label>
                            <input id="editFleet" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Type</label>
                            <input id="editType" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Overage</label>
                            <input id="editOverage" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Maximum</label>
                            <input id="editMaximum" type="text" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Comments</label>
                            <input id="editComment" type="text" class="form-control">
                        </div>
                    </div>

                    <div class="modal-footer">
                        <input type="button" class="btn btn-danger" data-dismiss="modal" value="Cancel">
                        <input type="submit" class="btn btn-success" data-dismiss="modal" value="Edit">
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Modal HTML -->
    <div id="deleteModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <form>
                    <div class="modal-header">
                        <h4 class="modal-title">Delete Record?</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this row?</p>
                        <p class="text-warning"><small>This action cannot be undone.</small></p>
                    </div>
                    <div class="modal-footer">
                        <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                        <input type="submit" class="btn btn-danger" data-dismiss="modal" value="Delete" id=deleteRow>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!--JQuery-->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>
    <!--File for Bootstrap table-->
    <script src="https://unpkg.com/bootstrap-table@1.16.0/dist/bootstrap-table.min.js"> </script>

    <!-- Sidebar Toggle Script -->
    <script>
        $("#menu-toggle").click(function (e) {
            e.preventDefault();
            $("#wrapper").toggleClass("toggled");
            $(this).find("i").toggleClass("icon-angle-right");
        });
    </script>

    <!--Import the data from JS Json file-->
    <script type="text/javascript" src="data.js"> </script>

    <!-- JS Display data to table-->
    <script type='text/javascript'>

        //For modifying data without a server, need to create local data
        localStorage.setItem('CDI-OVERRIDE', JSON.stringify(cdioverrideedits[1].data))
        localStorage.setItem('ENFORCE-FLEET', JSON.stringify(enforcefleetedits[1].data))

        //Get the data to display to bootstrap table for CDI OVERRIDE TABLE ONLY
        var cdiStoredData = JSON.parse(localStorage.getItem('CDI-OVERRIDE' || []))
        var cdiNewData = JSON.parse(localStorage.getItem('CDI-OVERRIDE' || []))

        //Get the data to display to bootstrap table for CDI OVERRIDE TABLE ONLY
        var enforceStoredData = JSON.parse(localStorage.getItem('ENFORCE-FLEET' || []))
        var enforceNewData = JSON.parse(localStorage.getItem('ENFORCE-FLEET' || []))

        //Populate CDI OVERRIDE EDITS Table
        $("#cdi-override").click(function (e) {

            //Keeps counter on how many times button is clicked for tracking new data after adding
            var count = $(this).data("count") || 0;

            if (count < 1) {
                //loads the data for first click

                //Clears table before populating
                $('table').bootstrapTable('destroy');

                // Creates the bootstrap table with the data provided
                $('table').bootstrapTable({
                    data: cdiStoredData
                });

            } else {
                //loads new data if button is clicked more than once
                $('table').bootstrapTable('load', cdiNewData);

            }

            //adds 1 to counter everytime button is clicked
            $(this).data("count", ++count);

            // Adds the title of the table to table and Add button
            document.getElementById("addTableTitleHere").innerHTML =
                "<h3 style='display: flex; justify-content: space-between; margin-top: 20px'>" + cdioverrideedits[0].tableName + '<a href="#addModal" id="addRow" data-toggle = "modal" class="btn btn-success">' + "Add" + "</a>" + "</h3>";

            //adds a new row to the table
            $("#addRow").click(function (e) {
                //new data to be pushed to table
                var pushData = {
                    "RuleLevel": "Test Rule",
                    "CustomerName": "GASTONTY (1323)",
                    "CityName": "Newark",
                    "State": "NJ",
                    "Fleet": "T02",
                    "Type": "Value",
                    "Overage": "50",
                    "Maximum": "100",
                    "LstMaintId": "B012936",
                    "LstMaintTS": "2017-08-09 15:43.49.657699",
                    "Comments": "New Row Added!",
                    "Actions": "&nbsp;<a href='#editModal' class='edit' data-toggle='modal'><i class='icon-edit icon-large' data-toggle='tooltip' title='Edit'></i></a> &nbsp; <a href='#deleteModal' class='delete' data-toggle='modal'><i class='icon-trash icon-large' data-toggle='tooltip' title='Delete'></i></a>"
                }

                cdiNewData.push(pushData);

                localStorage.setItem('CDI-OVERRIDE', JSON.stringify(cdiNewData))

                $('table').bootstrapTable('append', pushData);

            });

            //TODO DELETE ROW
            /*
            $("#deleteRow").click(function (e) {
                var actions = $.map($('table').bootstrapTable('getSelections'), function (row) {
                    return row.RuleLevel
                });
                $('table').bootstrapTable('remove', {
                    field: 'Actions',
                    values: actions
                });
                console.log(actions);

            });
            */
        });


        //Populate ENFORCE FLEET EDITS Table
        $("#enforce-fleet").click(function (e) {

            //Keeps counter on how many times button is clicked for tracking new data after adding
            var count = $(this).data("count") || 0;

            if (count < 1) {
                //loads the data for first click

                //Clears table before populating
                $('table').bootstrapTable('destroy');

                // Creates the bootstrap table with the data provided
                $('table').bootstrapTable({
                    data: enforceStoredData
                });

            } else {
                //loads new data if button is clicked more than once
                $('table').bootstrapTable('load', enforceNewData);

            }
            //adds 1 to counter everytime button is clicked
            $(this).data("count", ++count);

            // Adds the title of the table to table
            document.getElementById("addTableTitleHere").innerHTML =
                "<h3 style='display: flex; justify-content: space-between; margin-top: 20px'>" + enforcefleetedits[0].tableName + '<a href="#addModal" id="addRow" data-toggle = "modal" class="btn btn-success">' + "Add" + "</a>" + "</h3>";

            //adds a new row to the table
            $("#addRow").click(function (e) {
                //new data to be pushed to table
                var pushData = {
                    "RuleLevel": "Test Rule",
                    "CustomerName": "GASTONTY (1323)",
                    "CityName": "Newark",
                    "State": "NJ",
                    "Fleet": "T02",
                    "Type": "Value",
                    "Overage": "50",
                    "Maximum": "100",
                    "LstMaintId": "B012936",
                    "LstMaintTS": "2017-08-09 15:43.49.657699",
                    "Comments": "New Row Added!",
                    "Actions": "&nbsp;<a href='#editModal' class='edit' data-toggle='modal'><i class='icon-edit icon-large' data-toggle='tooltip' title='Edit'></i></a> &nbsp; <a href='#deleteModal' class='delete' data-toggle='modal'><i class='icon-trash icon-large' data-toggle='tooltip' title='Delete'></i></a>"
                }

                enforceNewData.push(pushData);

                localStorage.setItem('ENFORCE-FLEET', JSON.stringify(enforceNewData))

                $('table').bootstrapTable('append', pushData);

            });
        });

        //TODO Search Functionality
        $(document).ready(function () {

            $("#filter").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $("#tableBody tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });

        });

        //TODO ADD/EDIT/DELETE ROWS

    </script>

</body>

</html>